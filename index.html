<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Typing Quest</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --rpg-bg: #111; --rpg-border: #fff; --rpg-red: #ff4757; --rpg-blue: #3498db; }
        body { background: var(--rpg-bg); color: #fff; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 10px; }
        
        #ui-layer { width: 100%; max-width: 500px; border: 3px solid #fff; border-radius: 8px; margin-bottom: 10px; background: #000; padding: 10px; display: flex; justify-content: space-around; font-size: 0.9rem; }
        #stage { width: 100%; max-width: 500px; height: 200px; border: 3px solid #fff; border-radius: 8px; background: #1a1a2e; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        #monster-sprite { font-size: 70px; transition: transform 0.1s; }
        .m-hp-container { width: 150px; height: 10px; background: #333; border: 1px solid #fff; margin-top: 10px; }
        #m-hp-bar { height: 100%; background: var(--rpg-red); width: 100%; transition: width 0.4s; }

        #msg-box { width: 100%; max-width: 500px; min-height: 50px; border: 3px solid #fff; border-radius: 8px; margin: 10px 0; padding: 10px; background: #000; text-align: center; box-sizing: border-box; }
        
        #battle-screen { width: 100%; max-width: 500px; padding: 20px; background: #222; border: 3px solid #fff; border-radius: 8px; box-sizing: border-box; }
        .sentence-box { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 15px 0; }
        .word-unit { padding: 8px 12px; border: 1px solid #777; border-radius: 4px; cursor: pointer; background: #333; }
        .word-unit.selected { background: var(--rpg-red); border-color: #fff; }

        #input-zone { display: none; text-align: center; }
        #type-input { background: #000; color: #fff; border: 2px solid #fff; padding: 10px; font-size: 1.2rem; width: 80%; text-align: center; }
        .btn { margin-top: 10px; padding: 10px 30px; background: #fff; color: #000; border: none; font-weight: bold; cursor: pointer; }

        /* è§£èª¬ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ */
        #exp-layer { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 450px; background: #000; border: 4px solid var(--rpg-blue); padding: 20px; z-index: 100; box-shadow: 0 0 20px rgba(0,0,0,1); }
        .exp-title { color: var(--rpg-blue); font-weight: bold; border-bottom: 1px solid #fff; margin-bottom: 10px; }
        
        .damage { animation: shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)} }
        .p-damage { animation: flashRed 0.2s 2; }
        @keyframes flashRed { 0%,100%{background:#000} 50%{background:#500} }
    </style>
</head>
<body>

<div id="ui-layer">
    <div>å‹‡è€… LV:<span id="p-lv">1</span></div>
    <div>HP: <span id="p-hp">50</span> / 50</div>
</div>

<div id="stage">
    <div id="monster-sprite">ğŸ</div>
    <div class="m-hp-container"><div id="m-hp-bar"></div></div>
</div>

<div id="msg-box">é–“é•ã„ã‚’ã‚¿ãƒƒãƒã—ã¦ã€æ­£è§£ã‚’ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã›ã‚ˆï¼</div>

<div id="battle-screen">
    <div id="game-play">
        <div id="ja-text" style="color:#eccc68; font-weight:bold; margin-bottom:10px;"></div>
        <div id="sentence-area" class="sentence-box"></div>
        <div id="input-zone">
            <input type="text" id="type-input" autocomplete="off" placeholder="æ­£ã—ã„ã‚¹ãƒšãƒ«...">
            <br>
            <button class="btn" onclick="submitAttack()">ATTACK!</button>
        </div>
    </div>
</div>

<div id="exp-layer">
    <div class="exp-title" id="exp-res">BATTLE INFO</div>
    <p id="exp-text" style="line-height:1.6;"></p>
    <div style="text-align:right;">
        <button class="btn" onclick="closeExp()">æ¬¡ã¸é€²ã‚€ â–¶</button>
    </div>
</div>

<script>
const quizData = [
    {ja:"ã“ã®æ‰‹ç´™ã¯å¥ã«ã‚ˆã£ã¦æ›¸ã‹ã‚Œã¾ã—ãŸã€‚", sen:["this", "letter", "was", "wrote", "by", "ken", "."], target:"wrote", ans:"written", exp:"å—ã‘èº«ã¯ã€beå‹•è©ï¼‹éå»åˆ†è©ã€‘ã€‚writeã®éå»åˆ†è©ã¯writtenã§ã™ã€‚", m:"ğŸ"},
    {ja:"è‹±èªã¯å¤šãã®å›½ã§è©±ã•ã‚Œã¦ã„ã¾ã™ã€‚", sen:["english", "is", "speak", "in", "many", "countries", "."], target:"speak", ans:"spoken", exp:"speakã®éå»åˆ†è©ã¯spokenã€‚ä¸è¦å‰‡å¤‰åŒ–ã«æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚", m:"ğŸ¦‡"},
    {ja:"ç§ã¯3å¹´é–“ãšã£ã¨ãƒ†ãƒ‹ã‚¹ã‚’ã—ã¦ã„ã¾ã™ã€‚", sen:["i", "have", "play", "tennis", "for", "three", "years", "."], target:"play", ans:"played", exp:"ç¾åœ¨å®Œäº†ï¼ˆç¶™ç¶šï¼‰ã¯ã€haveï¼‹éå»åˆ†è©ã€‘ã€‚è¦å‰‡å‹•è©ãªã®ã§-edã‚’ã¤ã‘ã¾ã™ã€‚", m:"ğŸº"},
    {ja:"å½¼ã¯ã¡ã‚‡ã†ã©é§…ã«ç€ã„ãŸã¨ã“ã‚ã§ã™ã€‚", sen:["he", "has", "just", "arrive", "at", "the", "station", "."], target:"arrive", ans:"arrived", exp:"å®Œäº†ã®æ„å‘³ã§ã‚‚éå»åˆ†è©arrivedãŒå¿…è¦ã§ã™ã€‚", m:"ğŸ’€"},
    {ja:"ã‚‚ã—ç§ãŒã‚ãªãŸãªã‚‰ã€ãã“ã¸è¡Œãã®ã«ã€‚", sen:["if", "i", "am", "you", ",", "i", "would", "go", "there", "."], target:"am", ans:"were", exp:"ä»®å®šæ³•éå»ã§ã¯ã€ç¾åœ¨ã®äº‹å®Ÿã¨ç•°ãªã‚‹æƒ³åƒã‚’è¡¨ã™ãŸã‚ã«wereã‚’ä½¿ã„ã¾ã™ã€‚", m:"ğŸ‰"}
];

let mHp = 100, pHp = 50, lv = 1, currentQ = null, answered = false;

function loadQuest() {
    answered = false;
    currentQ = quizData[Math.floor(Math.random() * quizData.length)];
    document.getElementById('ja-text').innerText = "å’Œè¨³ï¼š" + currentQ.ja;
    document.getElementById('monster-sprite').innerText = currentQ.m;
    document.getElementById('input-zone').style.display = 'none';
    document.getElementById('type-input').value = "";
    document.getElementById('msg-box').innerText = "é–“é•ã„ã‚’ã‚¿ãƒƒãƒã›ã‚ˆï¼";
    
    const area = document.getElementById('sentence-area');
    area.innerHTML = "";
    currentQ.sen.forEach(word => {
        const div = document.createElement('div');
        div.className = 'word-unit'; div.innerText = word;
        div.onclick = function() { if(!answered) selectWord(this, word); };
        area.appendChild(div);
    });
}

function selectWord(el, word) {
    if(word === currentQ.target) {
        el.classList.add('selected');
        document.getElementById('msg-box').innerText = "æ­£è§£ã®ç¶´ã‚Šã‚’å…¥åŠ›ã—ã¦ATTACKï¼";
        document.getElementById('input-zone').style.display = 'block';
        document.getElementById('type-input').focus();
    } else {
        pHp -= 5; updateUI();
        document.getElementById('msg-box').innerText = "ãã“ã¯é–“é•ã£ã¦ã„ãªã„ï¼åæ’ƒï¼";
    }
}

function submitAttack() {
    answered = true;
    const val = document.getElementById('type-input').value.trim().toLowerCase();
    const isCorrect = (val === currentQ.ans.toLowerCase());
    
    if(isCorrect) {
        mHp -= 34;
        document.getElementById('monster-sprite').classList.add('damage');
        confetti({ particleCount: 100 });
        showExp("âœ¨ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ’ãƒƒãƒˆï¼", currentQ.exp);
    } else {
        pHp -= 15;
        document.body.classList.add('p-damage');
        showExp("ğŸ’€ æ”»æ’ƒå¤±æ•—...", `æ­£è§£ã¯ã€Œ${currentQ.ans}ã€ã§ã—ãŸã€‚<br>${currentQ.exp}`);
    }
    updateUI();
}

function showExp(res, text) {
    document.getElementById('exp-res').innerText = res;
    document.getElementById('exp-text').innerHTML = text;
    setTimeout(() => {
        document.getElementById('exp-layer').style.display = 'block';
    }, 500);
}

function closeExp() {
    document.getElementById('exp-layer').style.display = 'none';
    document.getElementById('monster-sprite').classList.remove('damage');
    document.body.classList.remove('p-damage');
    
    if(pHp <= 0) { alert("å‹‡è€…ã¯ãŸãŠã‚ŒãŸ..."); location.reload(); }
    else if(mHp <= 0) { lv++; mHp = 100; loadQuest(); }
    else { loadQuest(); }
    updateUI();
}

function updateUI() {
    document.getElementById('p-hp').innerText = Math.max(0, pHp);
    document.getElementById('p-lv').innerText = lv;
    document.getElementById('m-hp-bar').style.width = Math.max(0, mHp) + "%";
}

loadQuest();
</script>
</body>
</html>
