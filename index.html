<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Quest - é–“é•ã„æ¢ã—RPG</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --rpg-dark: #1a1a2e; --rpg-blood: #e94560; --rpg-grass: #0f3460; --rpg-text: #e2e2e2; }
        body { font-family: 'Courier New', sans-serif; background: #000; color: white; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 10px; }
        
        #game-container { width: 100%; max-width: 600px; background: var(--rpg-dark); border: 4px solid #fff; border-radius: 10px; overflow: hidden; }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
        .status-bar { padding: 10px; background: #000; display: flex; justify-content: space-between; border-bottom: 2px solid #fff; }
        
        /* ãƒãƒˆãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
        #battle-field { height: 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #16213e; position: relative; }
        #monster-sprite { font-size: 70px; transition: transform 0.2s; }
        .hp-bar { width: 200px; height: 12px; background: #444; border: 2px solid #fff; margin-top: 5px; }
        #m-hp-fill { height: 100%; background: var(--rpg-blood); width: 100%; transition: 0.3s; }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #msg-window { height: 60px; background: #000; padding: 10px; font-size: 1rem; border-top: 2px solid #fff; display: flex; align-items: center; justify-content: center; text-align: center; }

        /* å•é¡Œã‚¨ãƒªã‚¢ï¼ˆé–“é•ã„æ¢ã—ï¼‰ */
        #quiz-area { padding: 20px; background: #0f3460; min-height: 220px; }
        .ja-hint { color: #f9ed69; font-weight: bold; margin-bottom: 15px; font-size: 1.1rem; }
        
        .word-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 10px; }
        .word-node { 
            padding: 8px 12px; background: #16213e; border: 1px solid #fff; border-radius: 5px; 
            cursor: pointer; font-size: 1.2rem; transition: 0.2s;
        }
        .word-node:hover { background: #e94560; }
        
        /* ä¿®æ­£é¸æŠè‚¢ */
        #fix-menu { display: none; margin-top: 20px; border-top: 1px dashed #fff; padding-top: 15px; }
        .fix-btn { padding: 10px 20px; margin: 5px; background: #000; color: white; border: 2px solid #fff; cursor: pointer; }
        .fix-btn:hover { background: #e94560; }

        .shake { animation: shake 0.3s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(5px)} 75%{transform:translateX(-5px)} }
    </style>
</head>
<body>

<div id="game-container">
    <div class="status-bar">
        <div>å‹‡è€… LV <span id="lv">1</span></div>
        <div>HP: <span id="hp">50</span></div>
    </div>

    <div id="battle-field">
        <div id="m-name" style="font-weight:bold; margin-bottom:5px;">ERROR SLIME</div>
        <div id="monster-sprite">ğŸ‘ï¸â€ğŸ—¨ï¸</div>
        <div class="hp-bar"><div id="m-hp-fill"></div></div>
    </div>

    <div id="msg-window">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®å‘ªæ–‡ã‚’è§£èª­ã›ã‚ˆï¼</div>

    <div id="quiz-area">
        <div id="start-screen" style="text-align:center;">
            <button class="fix-btn" style="font-size:1.5rem;" onclick="startBattle()">å†’é™ºã‚’é–‹å§‹ã™ã‚‹</button>
        </div>
        
        <div id="battle-screen" style="display:none;">
            <div class="ja-hint" id="ja-text"></div>
            <p>â†“é–“é•ã„ã‚’ã‚¿ãƒƒãƒã—ã¦æ”»æ’ƒï¼</p>
            <div id="sentence-box" class="word-container"></div>
            
            <div id="fix-menu">
                <p>ã©ã†ä¿®æ­£ã™ã‚‹ï¼Ÿ</p>
                <div id="fix-options"></div>
            </div>
        </div>
    </div>
</div>

<script>
// å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼šé–“é•ã„ã‚’å«ã‚“ã æ–‡ã€é–“é•ã„ã®å˜èªã€æ­£ã—ã„å˜èªã€ãƒ€ãƒŸãƒ¼
const quizData = [
    {ja:"ã“ã®æ‰‹ç´™ã¯å¥ã«ã‚ˆã£ã¦æ›¸ã‹ã‚Œã¾ã—ãŸã€‚", wrongSen:["this", "letter", "was", "wrote", "by", "ken", "."], target:"wrote", correct:"written", dummys:["writing", "write"]},
    {ja:"è‹±èªã¯å¤šãã®å›½ã§è©±ã•ã‚Œã¦ã„ã¾ã™ã€‚", wrongSen:["english", "is", "speak", "in", "many", "countries", "."], target:"speak", correct:"spoken", dummys:["speaks", "speaking"]},
    {ja:"ç§ã¯3å¹´é–“ãšã£ã¨ãƒ†ãƒ‹ã‚¹ã‚’ã—ã¦ã„ã¾ã™ã€‚", wrongSen:["i", "have", "play", "tennis", "for", "three", "years", "."], target:"play", correct:"played", dummys:["playing", "plays"]},
    {ja:"å½¼ãŒã©ã“ã«ä½ã‚“ã§ã„ã‚‹ã‹çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ", wrongSen:["do", "you", "know", "where", "does", "he", "live", "?"], target:"does", correct:"(å‰Šé™¤)", dummys:["did", "is"]},
    {ja:"ã‚‚ã—ç§ãŒé³¥ãªã‚‰ã€é£›ã‚“ã§ã„ãã®ã«ã€‚", wrongSen:["if", "i", "am", "a", "bird", ",", "i", "would", "fly", "."], target:"am", correct:"were", dummys:["was", "are"]}
];

let mHp = 100, pHp = 50, qIndex = 0;
let selectedWord = "";

function startBattle() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('battle-screen').style.display = 'block';
    loadQuest();
}

function loadQuest() {
    const q = quizData[Math.floor(Math.random() * quizData.length)];
    document.getElementById('ja-text').innerText = "å’Œè¨³ï¼šã€Œ" + q.ja + "ã€";
    document.getElementById('fix-menu').style.display = 'none';
    document.getElementById('msg-window').innerText = "é–“é•ã„ã‚’æŒ‡æ‘˜ã›ã‚ˆï¼";
    
    const box = document.getElementById('sentence-box');
    box.innerHTML = "";
    
    q.wrongSen.forEach(word => {
        const span = document.createElement('div');
        span.className = 'word-node';
        span.innerText = word;
        span.onclick = () => selectWord(word, q);
        box.appendChild(span);
    });
}

function selectWord(word, q) {
    selectedWord = word;
    if(word === q.target) {
        document.getElementById('msg-window').innerText = `ã€Œ${word}ã€ãŒæ€ªã—ã„ï¼ã©ã†ç›´ã™ï¼Ÿ`;
        showFixMenu(q);
    } else {
        pHp -= 5;
        document.getElementById('hp').innerText = pHp;
        document.getElementById('msg-window').innerText = "ãã“ã¯é–“é•ã£ã¦ã„ãªã„ï¼åæ’ƒã‚’å—ã‘ãŸï¼";
        if(pHp <= 0) alert("å‹‡è€…ã¯ãŸãŠã‚ŒãŸ...");
    }
}

function showFixMenu(q) {
    const menu = document.getElementById('fix-menu');
    const options = document.getElementById('fix-options');
    menu.style.display = 'block';
    options.innerHTML = "";
    
    const choices = [q.correct, ...q.dummys].sort(() => Math.random() - 0.5);
    choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'fix-btn';
        btn.innerText = choice;
        btn.onclick = () => handleAttack(choice === q.correct);
        options.appendChild(btn);
    });
}

function handleAttack(isCorrect) {
    if(isCorrect) {
        mHp -= 34;
        document.getElementById('monster-sprite').classList.add('shake');
        document.getElementById('msg-window').innerText = "ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ’ãƒƒãƒˆï¼å‘ªæ–‡ã‚’ä¿®æ­£ã—ãŸï¼";
        confetti({ particleCount: 100, spread: 70 });
        setTimeout(() => {
            document.getElementById('monster-sprite').classList.remove('shake');
            if(mHp <= 0) {
                alert("ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’æµ„åŒ–ã—ãŸï¼");
                location.reload();
            } else {
                loadQuest();
            }
            updateM();
        }, 1000);
    } else {
        pHp -= 10;
        document.getElementById('hp').innerText = pHp;
        document.getElementById('msg-window').innerText = "ä¿®æ­£ã«å¤±æ•—ï¼æ‰‹ç—›ã„åæ’ƒï¼";
    }
}

function updateM() {
    document.getElementById('m-hp-fill').style.width = mHp + "%";
}
</script>
</body>
</html>
